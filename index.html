<!-- ===== HEADER (ПК — без изменений; моб. меню добавлено) ===== -->
<header class="header" id="top">
  <div class="wrap bar">
    <a href="#top" class="brand" id="brandLink">
      <img src="assets/logo.png" alt="Pro Carwash Halden">
      <span>Pro Carwash Halden</span>
    </a>

    <nav class="nav" id="nav" role="navigation" aria-label="Hovedmeny">
      <a href="#about">Om oss</a>
      <a href="#services">Tjenester</a>
      <a href="#pricing">Priser</a>
      <a href="#gallery">Galleri</a>
      <a href="#contact">Kontakt</a>
    </nav>

    <!-- Кнопка меню — только на мобиле -->
    <button id="burger" class="burger-btn" aria-label="Åpne meny"
            aria-controls="nav" aria-expanded="false">
      <span class="burger-ico">☰</span>
      <span class="burger-text">Meny</span>
    </button>
  </div>
</header>

<!-- ===== ТОЛЬКО ДЛЯ МОБИЛЫ: стили и «жёсткий» оверрайд ===== -->
<style>
  .burger-btn{display:none}

  /* Порог моб-версии: можно сменить на 768/992 при желании */
  @media (max-width:840px){
    .burger-btn{
      display:flex; align-items:center; gap:8px;
      padding:10px 14px; border:1.5px solid rgba(105,185,255,.6);
      border-radius:999px; background:rgba(11,25,54,.9);
      color:#cfe3fb; font-weight:800; cursor:pointer; z-index:110;
      box-shadow:0 6px 18px rgba(0,0,0,.25)
    }
    .burger-ico{font-size:1.2rem}
    .burger-text{font-size:1rem}

    /* Панель меню (по умолчанию скрыта) */
    .header .nav{
      display:none; position:fixed; top:0; right:0; bottom:0;
      width:84vw; max-width:360px; padding:18px 18px 22px;
      background:rgba(11,25,54,.97); backdrop-filter:blur(10px);
      border-left:1px solid rgba(255,255,255,.08);
      border-top-left-radius:16px; border-bottom-left-radius:16px;
      box-shadow:-12px 0 28px rgba(0,0,0,.35);
      flex-direction:column; gap:10px; z-index:109;
      transform:translateX(12px); opacity:0;
      transition:transform .2s ease, opacity .2s ease;
    }
    /* Открытое меню — показываем, перекрываем любые ранние правила */
    body.nav-open .header .nav{ display:flex !important; transform:none; opacity:1 }

    .header .nav a{
      display:block; font-size:20px; font-weight:900;
      color:#e8f1ff; text-decoration:none;
      padding:12px 12px; border-radius:12px;
    }
    .header .nav a:hover{ background:rgba(255,255,255,.10) }
    .header .nav a.active{ background:rgba(105,185,255,.15); outline:1px solid rgba(105,185,255,.35) }

    /* Фон под панелью */
    .nav-overlay{ display:none }
    body.nav-open .nav-overlay{
      display:block; position:fixed; inset:0; background:rgba(0,0,0,.48); z-index:108;
    }
  }
</style>

<!-- ===== ЛОГИКА МЕНЮ (скролл с учётом шапки, защита от конфликтов) ===== -->
<script>
(function(){
  var header = document.querySelector('.header');
  var nav    = document.getElementById('nav');
  var burger = document.getElementById('burger');

  if(!header || !nav) return;

  // фон под мобильным меню
  var overlay = document.querySelector('.nav-overlay');
  if(!overlay){
    overlay = document.createElement('div');
    overlay.className = 'nav-overlay';
    document.body.appendChild(overlay);
  }

  function setOpen(open){
    document.body.classList.toggle('nav-open', !!open);
    if(burger) burger.setAttribute('aria-expanded', !!open);
  }

  // бургер и закрытие по фону
  if(burger){
    burger.addEventListener('click', function(){
      setOpen(!document.body.classList.contains('nav-open'));
    });
  }
  overlay.addEventListener('click', function(){ setOpen(false); });

  // плавный скролл к секции (с фикс-отступом под шапку)
  function smartScrollTo(hash){
    if(!hash) return;
    var id = hash.charAt(0)==='#' ? hash.slice(1) : hash;
    var el = document.getElementById(id) || document.querySelector('#'+CSS.escape(id));
    if(el){
      // ждём кадр, чтобы меню успело закрыться/перерисоваться
      requestAnimationFrame(function(){
        var y = el.getBoundingClientRect().top + window.pageYOffset - (header.offsetHeight + 8);
        window.scrollTo({ top:y, behavior:'smooth' });
      });
    }else{
      location.hash = '#'+id;
    }
  }

  // КЛИКИ ПО ПУНКТАМ МЕНЮ: закрыть и проскроллить
  // capture + stopImmediatePropagation — чтобы перебить любые другие обработчики
  nav.addEventListener('click', function(e){
    var link = e.target.closest && e.target.closest('a[href^="#"]');
    if(!link) return;
    e.preventDefault();
    e.stopPropagation();
    if(e.stopImmediatePropagation) e.stopImmediatePropagation();

    var hash = link.getAttribute('href');
    setOpen(false);
    setTimeout(function(){ smartScrollTo(hash); }, 30);

    // подсветка активного пункта
    [].forEach.call(nav.querySelectorAll('a'), function(a){
      a.classList.toggle('active', a === link);
    });
  }, true);

  // логотип — к самому верху
  var brand = document.getElementById('brandLink');
  if(brand){
    brand.addEventListener('click', function(e){
      e.preventDefault();
      setOpen(false);
      window.scrollTo({ top:0, behavior:'smooth' });
    }, true);
  }

  // Esc закрывает; на десктоп — сброс состояния
  document.addEventListener('keydown', function(e){ if(e.key==='Escape') setOpen(false); });
  window.addEventListener('resize', function(){ if(window.innerWidth > 840) setOpen(false); });
})();
</script>
